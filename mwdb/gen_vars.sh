#!/bin/sh

MWDB_ADMIN_PASSWORD=$(od -vN 18 -An -tx1 /dev/urandom | tr -d " \n")
MWDB_SECRET_KEY=$(od -vN 18 -An -tx1 /dev/urandom | tr -d " \n")
POSTGRES_PASSWORD=$(od -vN 18 -An -tx1 /dev/urandom | tr -d " \n")
MINIO_SECRET_KEY=$(od -vN 18 -An -tx1 /dev/urandom | tr -d " \n")

# ---------[ MINIO ]--------- #
cat <<EOF > minio-vars.env
MINIO_ACCESS_KEY=mwdb
MINIO_SECRET_KEY=${MINIO_SECRET_KEY}
EOF

# ---------[ MWDB ]--------- #
cat <<EOF > mwdb-vars.env
MWDB_POSTGRES_URI=postgresql://mwdb:${POSTGRES_PASSWORD}@postgres/mwdb
MWDB_SECRET_KEY=${MWDB_SECRET_KEY}
MWDB_ADMIN_LOGIN=admin
MWDB_ADMIN_EMAIL=admin@localhost
MWDB_ADMIN_PASSWORD=${MWDB_ADMIN_PASSWORD}
UWSGI_PROCESSES=4
MWDB_S3_STORAGE_ACCESS_KEY=mwdb
MWDB_S3_STORAGE_SECRET_KEY=${MINIO_SECRET_KEY}
EOF

# ---------[ Postgres ]--------- #
cat <<EOF > postgres-vars.env
POSTGRES_USER=mwdb
POSTGRES_DB=mwdb
POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
EOF

# ---------[ Karton ]--------- #
cat <<EOF > karton.docker.ini
[redis]
host=redis

[s3]
access_key=mwdb
secret_key=${MINIO_SECRET_KEY}
address=http://minio:9000
bucket=karton

[mwdb]
api_url=http://mwdb:8080/api/
username=admin
password=${MWDB_ADMIN_PASSWORD}
EOF

# ---------[ echo ]--------- #
echo "Credentials for initial mwdb account:"
echo ""
echo "-----------------------------------------"
echo "Admin login: admin"
echo "Admin password: $MWDB_ADMIN_PASSWORD"
echo "-----------------------------------------"
echo ""